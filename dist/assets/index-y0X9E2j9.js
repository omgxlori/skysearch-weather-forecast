(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(e){if(e.ep)return;e.ep=!0;const c=r(e);fetch(e.href,c)}})();const g=document.getElementById("search-form"),u=document.getElementById("search-input"),p=document.querySelector("#today"),d=document.querySelector("#forecast"),s=document.getElementById("history"),w=document.getElementById("search-title"),L=document.getElementById("temp"),C=document.getElementById("wind"),b=document.getElementById("humidity"),y=async t=>{try{const r=await(await fetch("/api/weather/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:t})})).json();if(!r.currentWeather)throw new Error("No current weather data found");console.log("Weather Data:",r),x(r.currentWeather,r.timezone),v(r.forecast)}catch(n){console.error("Error fetching weather data:",n)}},S=async()=>{try{const t=await fetch("/api/weather/history");if(!t.ok)throw new Error("Error fetching search history");const n=await t.json();return console.log("Fetched search history:",n),n}catch(t){return console.error("Error fetching search history:",t),[]}},x=(t,n)=>{const{cityName:r,icon:o,description:e,temperature:c,windSpeed:a,humidity:i}=t,l=new Date,m=l.getTime()+l.getTimezoneOffset()*6e4,h=new Date(m+n*1e3).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"});w.innerHTML=`${r} (${h}) <img src="https://openweathermap.org/img/w/${o}.png" alt="${e}" class="weather-icon">`,L.textContent=`Temp: ${c}°F`,C.textContent=`Wind: ${a} MPH`,b.textContent=`Humidity: ${i} %`,p&&(p.innerHTML="",p.append(w,L,C,b))},v=t=>{const n=document.createElement("div"),r=document.createElement("h4");n.setAttribute("class","col-12"),r.textContent="5-Day Forecast:",n.append(r),d&&(d.innerHTML="",d.append(n));for(let o=0;o<t.length;o++){const e=t[o];F({date:e.date,icon:e.icon,iconDescription:e.description,tempF:e.temperature,windSpeed:e.windSpeed,humidity:e.humidity})}},F=t=>{const{date:n,icon:r,iconDescription:o,tempF:e,windSpeed:c,humidity:a}=t,{col:i,cardTitle:l,weatherIcon:m,tempEl:E,windEl:h,humidityEl:H}=I(),T=new Date(n).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"});l.textContent=T,m.setAttribute("src",`https://openweathermap.org/img/w/${r}.png`),m.setAttribute("alt",o),E.textContent=`Temp: ${e.toFixed(1)} °F`,h.textContent=`Wind: ${c} MPH`,H.textContent=`Humidity: ${a} %`,i.classList.add("forecast-card"),d&&d.append(i)},D=t=>{if(s){if(s.innerHTML="",t.length===0){s.innerHTML='<p class="text-center">No Previous Search History</p>';return}t.forEach(n=>{const r=document.createElement("button");r.textContent=n.name,r.classList.add("history-btn","btn","btn-secondary","m-1"),r.addEventListener("click",()=>{y(n.name)});const o=document.createElement("button");o.classList.add("delete-btn","btn","btn-danger","m-1"),o.textContent="Delete",o.setAttribute("data-city",JSON.stringify(n)),o.addEventListener("click",B);const e=document.createElement("div");e.append(r,o),s.appendChild(e)})}},I=()=>{const t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("h5"),e=document.createElement("img"),c=document.createElement("p"),a=document.createElement("p"),i=document.createElement("p");return t.append(n),n.append(r),r.append(o,e,c,a,i),t.classList.add("col-auto"),n.classList.add("forecast-card","card","text-white","bg-primary","h-100"),r.classList.add("card-body","p-2"),o.classList.add("card-title"),c.classList.add("card-text"),a.classList.add("card-text"),i.classList.add("card-text"),{col:t,cardTitle:o,weatherIcon:e,tempEl:c,windEl:a,humidityEl:i}},O=t=>{if(t.preventDefault(),!u.value)throw new Error("City cannot be blank");const n=u.value.trim();y(n).then(()=>{f()}).catch(r=>{console.error("Error fetching weather or rendering history:",r)}),u.value=""},$=t=>{if(t.target.matches(".history-btn")){const n=t.target.textContent;y(n).then(f)}},B=async t=>{t.stopPropagation();const n=JSON.parse(t.target.getAttribute("data-city")).id;try{if(!(await fetch(`/api/weather/history/${n}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete city");const o=await S();D(o)}catch(r){console.error("Error deleting city:",r)}},f=()=>{S().then(D).catch(t=>{console.error("Error rendering search history:",t)})};g?g.addEventListener("submit",O):console.error("searchForm element not found");s?s.addEventListener("click",$):console.error("searchHistoryContainer element not found");document.addEventListener("DOMContentLoaded",()=>{f()});
